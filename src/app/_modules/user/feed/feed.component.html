<ion-header class="header-vine">
	<ion-toolbar>
		<ion-menu-button>
			<span class="fa fa-bars"></span>
		</ion-menu-button>
		<ion-title>Vine</ion-title>
		<div *ngIf="user" class="user-profile-pic--header">
			<img [src]="user.photoURL" alt="User Profile Image" [routerLink]="[ '/user/profile']" />
		</div>
	</ion-toolbar>
</ion-header>

<ion-content class="content-bg">
	<ion-refresher (ionRefresh)="doRefresh($event)">
		<ion-refresher-content pullingIcon="arrow-dropdown" pullingText="Pull to refresh" refreshingSpinner="circles">
		</ion-refresher-content>
	</ion-refresher>
	<ion-grid no-padding>
		<ion-row>
			<ion-col size="12" offset="0" size-sm="10" offset-sm="1" size-lg="8" offset-lg="2" size-xl="6" offset-xl="3">
				<div class="post-feed-wrap">
					<ion-input placeholder="Post Something.." [(ngModel)]="newMessage"></ion-input>

					<ion-button class="post-feed-btn" (click)="addActivity()">
						Post <span class="fa fa-send"></span>
					</ion-button>
				</div>
			</ion-col>
		</ion-row>

		<ion-row>
			<ion-col size="12" offset="0" size-sm="10" offset-sm="1" size-lg="8" offset-lg="2" size-xl="6" offset-xl="3">

				<!--  feeds list -->
				<ion-list class="feed-list-wrap" *ngIf="activitiesStoredLocally?.length && !loading">
					<div class="feed-list" *ngFor="let activity of activitiesStoredLocally; let i = index">
						<ion-item>
							<ion-avatar slot="start">
								<!-- <img *ngIf="user.uid===activity.uid" [src]="user.photoURL" alt="Profile self Image" (click)="viewOtherProfile(activity)" /> -->
								<img [src]="imageArray[i]" alt="Profile other Image" (click)="viewOtherProfile(activity)" />
							</ion-avatar>
							<ion-label>
								<h3 *ngIf="user.uid===activity.uid" (click)="viewOtherProfile(activity)">{{user.name}}</h3>
								<h3 *ngIf="user.uid!==activity.uid" (click)="viewOtherProfile(activity)">{{activity.actor}}</h3>
								<h5>{{activity.time | date:"medium"}}</h5>
							</ion-label>
							<ion-button [disabled]="userID === activity.uid" class="post-like-btn" (click)="addLikesToActivity(activity)">
								<i class="fa fa-thumbs-o-up"></i>
								<sup><span>{{activity.likes}}</span></sup>
							</ion-button>
						</ion-item>
						<div *ngIf="activity.isLink" class="image-and-text-wrap">
							<div class="image-and-title-wrap">
								<ion-thumbnail *ngIf="activity.linkContent?.image" slot="start">
									<img [src]="activity.linkContent?.image">
								</ion-thumbnail>
								<h5>{{activity.linkContent?.title}}</h5>
							</div>
							<p>{{activity.linkContent?.description}}</p>
						</div>
						<div *ngIf="activity.isImage" class="only-image-upload-wrap">
							<img [src]="activity.imageLink">
						</div>
						<!-- <div *ngIf="isPlatformCordova">
							<div *ngIf="activity.isYoutubeLink && !activity.isLink && !activity.isImage" class="image-and-text-wrap" text-center>
								<a (click)=" youtubeNativePlayer(activity.youtubeLinkContent?.videoId)">
									Play
								</a>
								<div class="image-and-title-wrap">
									<ion-thumbnail *ngIf="activity.youtubeLinkContent?.linkPreview.image" slot="start">
										<img [src]="activity.youtubeLinkContent?.linkPreview.image">
									</ion-thumbnail>
									<h5>{{activity.youtubeLinkContent?.linkPreview.title}}</h5>
								</div>
								<p>{{activity.youtubeLinkContent?.linkPreview.description}}</p>
							</div>
						</div>
						<div *ngIf="!isPlatformCordova">
							<div *ngIf="activity.isYoutubeLink && !activity.isLink && !activity.isImage" text-center>
								<iframe [src]="domSanitizer(activity.youtubeLinkContent?.embedLink)" height="207" width="368" frameborder="0" allow="autoplay; encrypted-media"
								 allowfullscreen></iframe>
							</div>
						</div> -->
						<div *ngIf="activity.isYoutubeLink" text-center>
							<youtube-player [videoId]="activity.youtubeLinkContent?.videoId" height="189" width="336"></youtube-player>
							<!-- <iframe [src]="domSanitizer(activity.youtubeLinkContent?.embedLink)" height="207" width="368" frameborder="0" allow="autoplay; encrypted-media"
							 allowfullscreen></iframe> -->
						</div>
						<p *ngIf="!activity.isLink && !activity.isImage" class="post-snippet">{{activity.object}}</p>
						<a *ngIf="activity.isLink && !activity.isImage" [href]="activity.linkContent?.url" target="_blank" class="post-link">{{activity.object}}</a>
					</div>
				</ion-list>
				<div class="row" *ngIf="!activitiesStoredLocally?.length && !loading" text-center>
					<div class="ion-col text-center">
						<p>No activities available</p>
					</div>
				</div>
				<!-- <ion-spinner name="dots"></ion-spinner> -->
				<div class="text-center" *ngIf="!activitiesStoredLocally?.length && loading" text-center>
					<div *ngIf="!activitiesStoredLocally.length && loadingActivity" text-center>
						<ion-spinner name="dots"></ion-spinner>
						<div>Loading Feeds..</div>
					</div>
				</div>
			</ion-col>
		</ion-row>
	</ion-grid>
</ion-content>